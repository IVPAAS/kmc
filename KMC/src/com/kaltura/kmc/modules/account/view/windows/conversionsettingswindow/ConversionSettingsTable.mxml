<?xml version="1.0" encoding="utf-8"?>
<mx:DataGrid xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" rowHeight="30"
			 headerRelease="headerReleaseHandler(event)" selectable="false">
	<mx:Script>
		<![CDATA[
			import com.kaltura.kmc.modules.account.events.ConversionSettingsEvent;
			import com.kaltura.kmc.modules.account.vo.ConversionProfileVO;
			import com.kaltura.kmc.modules.account.vo.FlavorVO;

			import mx.events.DataGridEvent;

			[Bindable]
			private var _allSelected:Boolean = false;
			[Bindable]
			private var _cProfile:ConversionProfileVO;


			/**
			 * @copy #editable
			 * */
			private var _dataEditable:Boolean = true;


			[Bindable]
			public function get cProfile():ConversionProfileVO {
				return _cProfile;
			}


			public function set cProfile(cProfile:ConversionProfileVO):void {
				_cProfile = cProfile;
			}


			override public function set dataProvider(value:Object):void {
				// roles & permissions - set editable
				for each (var vo:FlavorVO in value) {
					vo.editable = _dataEditable;
				}
				super.dataProvider = value;
				validateProfileFlavors();
			}


			private function validateProfileFlavors():void {
				var idsArr:Array = cProfile.profile.flavorParamsIds.split(',');
				var currentFlavors:Array = new Array();
				var vo:FlavorVO;
				for each (var id:String in idsArr) {
					for each (vo in dataProvider) {
						if (vo.kFlavor.id == int(id)) {
							currentFlavors.push(id);
						}
					}
				}

				var ids:String = currentFlavors.length == 0 ? null : currentFlavors.join(',');
				cProfile.profile.flavorParamsIds = ids;
			}


			[Bindable]
			public function get allSelected():Boolean {
				return _allSelected;
			}


			public function set allSelected(allSelected:Boolean):void {
				_allSelected = allSelected;
			}


			private function headerReleaseHandler(event:DataGridEvent):void {
				event.preventDefault();
			}


			public function dispatchSelection(event:Event = null):void {
				var tsEvent:ConversionSettingsEvent = new ConversionSettingsEvent(ConversionSettingsEvent.MARK_FLAVORS, !allSelected);
				tsEvent.dispatch();
			}


			public function isFlavorsSelected():Boolean {
				return !(_cProfile.profile.flavorParamsIds == null);
			}


			/**
			 * should data in the table be editable
			 * */
			public function get dataEditable():Boolean {
				return _dataEditable;
			}


			/**
			 * @private
			 */
			public function set dataEditable(value:Boolean):void {
				_dataEditable = value;
				for each (var vo:FlavorVO in dataProvider) {
					vo.editable = value;
				}
			}
		]]>
	</mx:Script>


	<mx:columns>
		<mx:DataGridColumn width="40"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorSelectionRenderer"/>
		<mx:DataGridColumn headerText="Conversion Flavor" dataField="transcodingFlavor"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorNameRenderer"/>
		<mx:DataGridColumn headerText="Description" dataField="description"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorDescriptionRenderer"/>
		<mx:DataGridColumn headerText="Format" dataField="format"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorFormatRenderer"/>
		<mx:DataGridColumn headerText="Codec" dataField="codec"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorCodecRenderer"/>
		<mx:DataGridColumn headerText="Bitrate(kbps)" dataField="bitrate"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorBitrateRenderer"/>
		<mx:DataGridColumn headerText="Dimensions" dataField="dimensions"
						   itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorDimensionsRenderer"/>
		<!--<mx:DataGridColumn headerText="Transcoder" dataField="transcoder" itemRenderer="com.kaltura.kmc.modules.account.view.windows.conversionsettingswindow.renderers.FlavorTranscoderRenderer"/>-->
	</mx:columns>
</mx:DataGrid>
