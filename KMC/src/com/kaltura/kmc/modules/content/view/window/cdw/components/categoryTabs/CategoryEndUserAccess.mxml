<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" 
		 creationComplete="initCategoryEndUserAcessTab(event)" implements="com.kaltura.kmc.modules.content.view.window.cdw.ICategoryDrilldownPanel">
	<mx:Script>
		<![CDATA[
			import com.kaltura.kmc.modules.content.events.CategoryEvent;
			import com.kaltura.kmc.modules.content.model.CategoriesModel;
			import com.kaltura.kmc.modules.content.view.window.OneRule;
			import com.kaltura.kmc.modules.content.view.window.cdw.users.ChangeOwnerWin;
			import com.kaltura.types.KalturaAppearInListType;
			import com.kaltura.types.KalturaContributionPolicyType;
			import com.kaltura.types.KalturaInheritanceType;
			import com.kaltura.types.KalturaPrivacyType;
			import com.kaltura.vo.KalturaCategory;
			
			import mx.binding.utils.BindingUtils;
			import mx.binding.utils.ChangeWatcher;
			import mx.core.mx_internal;
			import mx.events.FlexEvent;
			import mx.managers.PopUpManager;
			
			private const TEXT_WIDTH:Number = 264;
			private const LABEL_WIDTH:Number = 150;
			
			public var model:CategoriesModel;
			
			[Bindable] private var _category:KalturaCategory;
			public function get category() : KalturaCategory {return _category;}
			[Bindable] public function set category( value : KalturaCategory ) : void
			{
				_category = value;
			}


			protected function initCategoryEndUserAcessTab(event:FlexEvent):void
			{

			}
			
			protected function changeOwner() : void
			{
				var cowin : ChangeOwnerWin = new ChangeOwnerWin();
				cowin.undoOwnerId = _category.owner;
				PopUpManager.addPopUp( cowin , this , true);
				PopUpManager.centerPopUp( cowin );
			}
			
			public function validate():void{
				
			}
			
			public function save():void{
				if (category.inheritanceType == KalturaInheritanceType.INHERIT){
					var parentCat:KalturaCategory = model.parentCategory;
					category.userJoinPolicy = parentCat.userJoinPolicy;
					category.owner = parentCat.owner;
					category.defaultPermissionLevel = parentCat.defaultPermissionLevel;
					// TODO: handle end users as well.
				}
			}
			
			public function destroy():void{
				
			}
			
			
			public function clear():void{
				
			}
			
			
			public function initData():void{
				var cgEvent:CategoryEvent = new CategoryEvent(CategoryEvent.GET_PARENT_CATEGORY);
				cgEvent.data = category;
				cgEvent.dispatch();
			}
			
			public function init():void{
				
			}
			
			public function isChanged():Boolean{
				return false;
			}

		]]>
	</mx:Script>
	<mx:Label text="{resourceManager.getString('cms', 'endUserAccessTitle')}"/>
	<mx:HBox width="100%">
		<mx:Label width="{LABEL_WIDTH}" text="{resourceManager.getString('cms', 'integrationPrivacyKey')}"  styleName="drillDownLabel" />
		<mx:Text width="{TEXT_WIDTH}" styleName="drillDownSubLabel" text="{_category.privacyContexts}"/>
	</mx:HBox>
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString('cms', 'contentPrivacy')}" width="{LABEL_WIDTH}" styleName="drillDownLabel" />
		<mx:VBox width="100%">
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','noRestriction')}" 
								selected="{_category.privacy == KalturaPrivacyType.ALL}"
								change="{ if((event.target as RadioButton).selected)_category.privacy = KalturaPrivacyType.ALL }"
								groupName="contentPrivacy" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'noRestrictionDesc')}" styleName="smallLabel" />
			</mx:HBox>
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','requiresAuthentication')}"
								selected="{_category.privacy == KalturaPrivacyType.AUTHENTICATED_USERS}"
								change="{ if((event.target as RadioButton).selected)_category.privacy = KalturaPrivacyType.AUTHENTICATED_USERS }"
								groupName="contentPrivacy" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'requiresAuthenticationDesc')}" styleName="smallLabel" />
			</mx:HBox>
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','private')}"
								groupName="contentPrivacy" 
								selected="{_category.privacy == KalturaPrivacyType.MEMBERS_ONLY}"
								change="{ if((event.target as RadioButton).selected)_category.privacy = KalturaPrivacyType.MEMBERS_ONLY }"/>
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'privateDesc')}" styleName="smallLabel" />
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>
	<mx:HRule width="90%" />
	<mx:HBox width="100%">
		<mx:Label text="{resourceManager.getString('cms', 'categoryListing')}" width="{LABEL_WIDTH}" styleName="drillDownLabel" />
		<mx:VBox width="100%">
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','noRestriction')}"
								selected="{_category.appearInList == KalturaAppearInListType.PARTNER_ONLY}"
								change="{ if((event.target as RadioButton).selected)_category.appearInList = KalturaAppearInListType.PARTNER_ONLY }"
								groupName="categoryListing" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'noRestrictionDesc')}" styleName="smallLabel" />
			</mx:HBox>
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','private')}"
								selected="{_category.appearInList == KalturaAppearInListType.CATEGORY_MEMBERS_ONLY}"
								change="{ if((event.target as RadioButton).selected)_category.appearInList = KalturaAppearInListType.CATEGORY_MEMBERS_ONLY }"
								groupName="categoryListing" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'privateDesc')}" styleName="smallLabel"/>
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>	
	<mx:HRule width="90%" />
	<mx:HBox width="100%">
		<mx:Text text="{resourceManager.getString('cms', 'whoCanAddContent')}" width="{LABEL_WIDTH}" styleName="drillDownLabel" />
		<mx:VBox width="100%">
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','noRestriction')}"
								selected="{_category.contributionPolicy == KalturaContributionPolicyType.ALL}"
								change="{ if((event.target as RadioButton).selected)_category.contributionPolicy = KalturaContributionPolicyType.ALL }"
								groupName="whoCanAddContent" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'noRestrictionDesc')}" styleName="smallLabel"/>
			</mx:HBox>
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','private')}"
								selected="{_category.contributionPolicy == KalturaContributionPolicyType.MODERATOR}"
								change="{ if((event.target as RadioButton).selected)_category.contributionPolicy = KalturaContributionPolicyType.MODERATOR }"
								groupName="whoCanAddContent" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'privateDesc')}" styleName="smallLabel" />
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>	
	<mx:HRule width="90%" />
	<mx:HBox width="100%">
		<mx:Text text="{resourceManager.getString('cms', 'inheritEndUserSpecific')}" width="{LABEL_WIDTH}" styleName="drillDownLabel" />
		<mx:VBox width="100%">
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','no')}"
								selected="{_category.inheritanceType == KalturaInheritanceType.MANUAL}"
								change="{ if((event.target as RadioButton).selected)_category.inheritanceType = KalturaInheritanceType.MANUAL }"
								groupName="inheritEndUserSpecific" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'inheritEndUserSpecificNoDesc')}" styleName="smallLabel" />
			</mx:HBox>
			<mx:HBox styleName="plstAddRemoveCont">
				<mx:RadioButton label="{resourceManager.getString('cms','yes')}"
								selected="{_category.inheritanceType == KalturaInheritanceType.INHERIT}"
								change="{ if((event.target as RadioButton).selected)_category.inheritanceType = KalturaInheritanceType.INHERIT }"
								groupName="inheritEndUserSpecific" />
				<mx:Label width="100%" text="{resourceManager.getString('cms', 'inheritEndUserSpecificYesDesc')}" styleName="smallLabel" />
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>	
	<mx:VBox width="100%" styleName="flavorsReplacementVBox">
		<mx:HBox width="100%">
			<mx:Label text="{resourceManager.getString('cms', 'endUserSpecificActionPer')}" styleName="drillDownLabel" />
			<mx:Text styleName="drillDownSubLabel" text="{}" maxWidth="{TEXT_WIDTH}"/>
		</mx:HBox>
		<mx:HBox width="100%">
			<mx:Label text="{resourceManager.getString('cms', 'owner')}" styleName="drillDownLabel" />
			<mx:Text maxWidth="{TEXT_WIDTH}" styleName="drillDownSubLabel" text="{_category.owner}" />
			<mx:LinkButton label="{resourceManager.getString('cms', 'change')}" click="changeOwner()"/>
			<mx:VRule height="10" />
			<mx:Label text="{resourceManager.getString('cms', 'users')}"  styleName="drillDownLabel" />
			<mx:Text maxWidth="{TEXT_WIDTH}" styleName="drillDownSubLabel" text="{_category.membersCount}"/>
			<mx:LinkButton label="{resourceManager.getString('cms', 'change')}" />
		</mx:HBox>
	</mx:VBox>
</mx:VBox>
